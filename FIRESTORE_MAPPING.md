# Firestore Database Mapping Guide

## Overview
This document maps the original MySQL database schema to Firestore collections and provides sample data structures.

## Collection Mapping

### 1. **teams** Collection
Maps from MySQL `teams` table

**Document ID:** Auto-generated by Firestore (or use `teamId` as custom ID)

**Sample Document:**
```json
{
  "teamName": "Phoenix Rising",
  "description": "Elite CS:GO competitive team",
  "totalPoints": 120,
  "wins": 8,
  "losses": 2,
  "createdAt": "2025-11-19T10:30:00Z",
  "updatedAt": "2025-11-19T14:20:00Z"
}
```

**Fields:**
- `teamName` (string) - Name of the team
- `description` (string) - Team description
- `totalPoints` (number) - Accumulated points from matches
- `wins` (number) - Number of wins
- `losses` (number) - Number of losses
- `createdAt` (timestamp) - Creation date
- `updatedAt` (timestamp) - Last update date

---

### 2. **players** Collection
Maps from MySQL `players` table

**Document ID:** Auto-generated by Firestore

**Sample Document:**
```json
{
  "playerName": "AlexPro",
  "role": "Rifler",
  "teamId": "team1",
  "kd_ratio": 1.45,
  "skill_rating": 92,
  "createdAt": "2025-11-19T10:30:00Z",
  "updatedAt": "2025-11-19T14:20:00Z"
}
```

**Fields:**
- `playerName` (string) - Player's in-game name
- `role` (string) - Position/role (e.g., Rifler, AWP, Support, IGL)
- `teamId` (string) - Reference to team document ID
- `kd_ratio` (number) - Kill/Death ratio
- `skill_rating` (number) - Skill rating 0-100
- `createdAt` (timestamp) - Creation date
- `updatedAt` (timestamp) - Last update date

**Index Recommendation:**
- Create composite index on `teamId` and `playerName` for faster queries

---

### 3. **tournaments** Collection
Maps from MySQL `tournaments` table

**Document ID:** Auto-generated by Firestore

**Sample Document:**
```json
{
  "tournamentName": "World Championship 2025",
  "description": "Global esports championship tournament",
  "status": "upcoming",
  "createdAt": "2025-11-19T10:30:00Z",
  "updatedAt": "2025-11-19T14:20:00Z"
}
```

**Fields:**
- `tournamentName` (string) - Tournament name
- `description` (string) - Tournament details
- `status` (string) - Status: `upcoming`, `ongoing`, `completed`
- `createdAt` (timestamp) - Creation date
- `updatedAt` (timestamp) - Last update date

---

### 4. **matches** Collection
Maps from MySQL `matches` table

**Document ID:** Auto-generated by Firestore

**Sample Document:**
```json
{
  "team1Id": "team1",
  "team2Id": "team2",
  "tournamentId": "t1",
  "scheduledDate": "2025-12-15T18:00:00Z",
  "status": "completed",
  "team1Score": 16,
  "team2Score": 14,
  "createdAt": "2025-11-19T10:30:00Z",
  "updatedAt": "2025-11-19T14:20:00Z"
}
```

**Fields:**
- `team1Id` (string) - Reference to first team
- `team2Id` (string) - Reference to second team
- `tournamentId` (string) - Reference to tournament (nullable)
- `scheduledDate` (timestamp) - When match is/was scheduled
- `status` (string) - Status: `scheduled`, `ongoing`, `completed`
- `team1Score` (number) - Score of team 1
- `team2Score` (number) - Score of team 2
- `createdAt` (timestamp) - Creation date
- `updatedAt` (timestamp) - Last update date

**Index Recommendation:**
- Create index on `status` for filtering by match status
- Create index on `scheduledDate` for chronological queries

---

### 5. **users** Collection
Maps from MySQL `admins` table (Authentication)

**Document ID:** Firebase Auth UID (automatically linked)

**Sample Document:**
```json
{
  "username": "AYUSH1234",
  "email": "admin@esports.com",
  "role": "admin",
  "createdAt": "2025-11-19T10:30:00Z"
}
```

**Fields:**
- `username` (string) - Admin username
- `email` (string) - Admin email
- `role` (string) - Role: `admin`, `moderator`, `user`
- `createdAt` (timestamp) - Account creation date

**Note:** Password is managed by Firebase Authentication, not stored in Firestore.

---

## Sample Data Import (JSON)

Use this JSON to bulk import sample data. You can import via Firebase Console or programmatically.

### teams.json
```json
[
  {
    "teamId": "team1",
    "teamName": "Phoenix Rising",
    "description": "Elite CS:GO competitive team",
    "totalPoints": 120,
    "wins": 8,
    "losses": 2
  },
  {
    "teamId": "team2",
    "teamName": "Dragon Force",
    "description": "Valorant specialists",
    "totalPoints": 95,
    "wins": 6,
    "losses": 4
  },
  {
    "teamId": "team3",
    "teamName": "Titan Squad",
    "description": "Dota 2 champions",
    "totalPoints": 105,
    "wins": 7,
    "losses": 3
  }
]
```

### players.json
```json
[
  {
    "playerId": "p1",
    "playerName": "AlexPro",
    "role": "Rifler",
    "teamId": "team1",
    "kd_ratio": 1.45,
    "skill_rating": 92
  },
  {
    "playerId": "p2",
    "playerName": "SniperKing",
    "role": "AWP",
    "teamId": "team1",
    "kd_ratio": 1.65,
    "skill_rating": 95
  },
  {
    "playerId": "p3",
    "playerName": "SupportGod",
    "role": "Support",
    "teamId": "team2",
    "kd_ratio": 0.95,
    "skill_rating": 88
  },
  {
    "playerId": "p4",
    "playerName": "MidMaster",
    "role": "Mid Laner",
    "teamId": "team3",
    "kd_ratio": 1.35,
    "skill_rating": 89
  }
]
```

### tournaments.json
```json
[
  {
    "tournamentId": "t1",
    "tournamentName": "World Championship 2025",
    "description": "Global esports championship tournament",
    "status": "upcoming"
  },
  {
    "tournamentId": "t2",
    "tournamentName": "Regional Qualifiers",
    "description": "Regional competition for World Championship",
    "status": "ongoing"
  }
]
```

### matches.json
```json
[
  {
    "matchId": "m1",
    "team1Id": "team1",
    "team2Id": "team2",
    "tournamentId": "t1",
    "scheduledDate": "2025-12-15T18:00:00Z",
    "status": "completed",
    "team1Score": 16,
    "team2Score": 14
  },
  {
    "matchId": "m2",
    "team1Id": "team1",
    "team2Id": "team3",
    "tournamentId": "t1",
    "scheduledDate": "2025-12-22T19:00:00Z",
    "status": "scheduled",
    "team1Score": 0,
    "team2Score": 0
  }
]
```

---

## Key Differences from MySQL

1. **No Joins:** Firestore uses references (storing IDs). To get related data, you must:
   - Query teams first
   - Then query players where `teamId == teamId`
   - Frontend JavaScript handles the assembly

2. **Timestamps:** Use Firestore's `serverTimestamp()` to ensure server-side timestamp accuracy

3. **Auto-increment IDs:** Firestore auto-generates document IDs. The `api.js` code uses these IDs directly.

4. **Denormalization:** For performance, consider denormalizing frequently-read data (e.g., storing `teamName` in matches for quick display)

---

## Firestore Security Rules

Add these rules to `firestore.rules`:

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Allow authenticated users to read data
    match /{document=**} {
      allow read: if request.auth != null;
      allow write: if request.auth.token.admin == true;
    }
    
    // Allow public read access (demo mode)
    match /{document=**} {
      allow read: if true;
    }
  }
}
```

---

## Querying Guide (JavaScript)

All queries are implemented in `api.js`. Here are common patterns:

### Get all teams
```javascript
const teams = await API.getTeams();
```

### Get teams by custom filter
```javascript
const snapshot = await db.collection('teams')
  .where('totalPoints', '>', 100)
  .orderBy('totalPoints', 'desc')
  .limit(5)
  .get();
```

### Get players for a team
```javascript
const players = await API.getTeamWithPlayers('team1');
```

### Get matches by status
```javascript
const matches = await db.collection('matches')
  .where('status', '==', 'completed')
  .get();
```

---

## Backup & Export

To backup data:
1. Go to Firebase Console > Firestore Database
2. Click **Start Collection** or **Menu** > **Export**
3. Export as JSON to your local machine

To restore:
1. Use Firebase CLI: `firebase firestore:restore <path-to-backup>`
2. Or upload manually via console

---

## Indexes

Firestore automatically creates indexes for common queries. For complex queries, you may need to create composite indexes manually:

**Required Composite Indexes:**
1. `players(teamId, playerName)`
2. `matches(status, scheduledDate)`
3. `teams(totalPoints, -status)` (descending for leaderboards)

Create these in Firebase Console > Firestore Database > Indexes tab.

---

## Limitations & Considerations

1. **Read/Write Limits:** Free tier allows 50,000 reads/day. Monitor usage in Firebase Console.
2. **Data Consistency:** Firestore is eventually consistent. Admin operations are strongly consistent.
3. **Real-time Updates:** Subscribe to collections with `.onSnapshot()` for live updates (see `auth.js` for example).
4. **Cost:** Consider read/write costs when importing large datasets.

---

## Demo Mode (localStorage)

When Firebase is not configured, the app uses **demo mode** with `localStorage`:
- All data stored in browser's local storage
- Data persists across sessions but only on that device
- Perfect for testing without Firebase configuration

To switch to demo mode, leave `firebase-config.js` with default values.
